<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="description" content="Cours et TP autour de Spring Boot">
<meta name="author" content="Olivier Capuozzo, Frédéric Varni">
<title>Spring Boot</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Spring Boot</h1>
<div class="details">
<span id="author" class="author">Olivier Capuozzo</span><br>
<span id="author2" class="author">Frédéric Varni</span><br>
<span id="revnumber">version 1.2,</span>
<span id="revdate">2021-01-12</span>
<br><span id="revremark">Version asciidoc</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table des matières</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#spring">Spring</a></li>
<li><a href="#spring-boot">Spring Boot</a></li>
<li><a href="#les-dépendances-d-une-application-spring-boot">Les dépendances d&#8217;une application Spring Boot</a></li>
<li><a href="#générer-une-application-spring-boot">Générer une application Spring Boot</a></li>
</ul>
</li>
<li><a href="#première-application">Première application</a>
<ul class="sectlevel2">
<li><a href="#une-première-application-spring-boot">Une première application Spring Boot</a></li>
<li><a href="#exercices">Exercices</a></li>
</ul>
</li>
<li><a href="#introduction-à-jpa">Introduction à JPA</a>
<ul class="sectlevel2">
<li><a href="#présentation">Présentation</a></li>
<li><a href="#définir-le-modèle">Définir le modèle</a></li>
<li><a href="#gérer-l-accès-aux-données-les-dépôts-repositories">Gérer l&#8217;accès aux données, les dépôts (repositories)</a></li>
<li><a href="#configurer-un-projet-spring-boot-pour-utiliser-jpa">Configurer un projet Spring Boot pour utiliser JPA</a></li>
<li><a href="#travail-à-faire">Travail à faire</a></li>
</ul>
</li>
<li><a href="#introduction-layout-avec-thymleaf">Introduction (layout avec thymleaf)</a>
<ul class="sectlevel2">
<li><a href="#présentation-3">Présentation</a></li>
<li><a href="#webjars-une-solution-java">webjars - une solution java</a></li>
<li><a href="#webjars-cas-bootstrap">webjars - cas bootstrap</a></li>
<li><a href="#layout-cas-thymeleaf">layout - cas thymeleaf</a></li>
<li><a href="#controleur">Controleur</a></li>
<li><a href="#documentation">Documentation</a></li>
</ul>
</li>
<li><a href="#internationalisation">Internationalisation</a>
<ul class="sectlevel2">
<li><a href="#présentation-4">Présentation</a></li>
<li><a href="#identification-de-la-langue-de-l-utilisateur">Identification de la langue de l&#8217;utilisateur</a></li>
<li><a href="#externalisation-des-messages">Externalisation des messages</a></li>
<li><a href="#configuration-des-chemins-de-messages">Configuration des chemins de messages</a></li>
<li><a href="#détection-et-changement-de-langue">Détection et changement de langue</a></li>
<li><a href="#format-des-messages">Format des messages</a></li>
<li><a href="#messages-en-dehors-de-thymeleaf">Messages en dehors de thymeleaf</a></li>
<li><a href="#conlusion">Conlusion</a></li>
</ul>
</li>
<li><a href="#validation">Validation</a>
<ul class="sectlevel2">
<li><a href="#présentation-5">Présentation</a></li>
<li><a href="#annotations-de-validation">Annotations de validation</a></li>
<li><a href="#validation-des-données-de-requêtes">Validation des données de requêtes</a></li>
<li><a href="#validation-de-niveau-attributs-de-bean">Validation de niveau attributs de bean</a></li>
<li><a href="#validation-de-niveau-bean">Validation de niveau bean</a></li>
<li><a href="#montrer-les-erreurs-logique-de-présentation">Montrer les erreurs (logique de présentation)</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="spring"><a class="anchor" href="#spring"></a>Spring</h3>
<div class="paragraph">
<p>Spring rend la programmation Java plus rapide, plus facile et plus sûre pour tout le monde. L&#8217;orientation de Spring sur la vitesse, la simplicité et la productivité en a fait l&#8217;un des plus populaires framework Java.</p>
</div>
<div class="paragraph">
<p>On retrouve Spring dans tous les contextes : depuis les sites de commerce en ligne jusqu&#8217;aux voitures connectées, en passant par les applications de streaming TV et bien d&#8217;autres applications.</p>
</div>
<div class="paragraph">
<p>Spring est un ensemble d&#8217;extensions et de bibliothèques tierces intégrées qui permet de bâtir à peu près n&#8217;importe quel type d&#8217;applicaton. Au coeur de Spring on retrouve l&#8217;Inversion de Contôle (Inversion of Control, <em>IoC</em>) et l&#8217;Injection de dépendances (Dependency Injection, <em>DI</em>), ces deux caractéristiques sont à la base d&#8217;un grand nombre d&#8217;autres caractéristiques et fonctionnalités.</p>
</div>
<div class="paragraph">
<p>Une application Spring <em>classique</em> est relativement difficile à mettre en oeuvre et demande une expertise certaine de la part du chef de projet pour en construire l&#8217;ossature et définir les fichiers de configuration. Spring Boot est une verion de Spring plus facile à mettre en oeuvre tout en offrant les mêmes avantages que Spring. Spring Boot évite notamment les fichiers de configuration XML complexes.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot"><a class="anchor" href="#spring-boot"></a>Spring Boot</h3>
<div class="paragraph">
<p>Spring Boot est une version de Spring qui privilégie les conventions plutôt que les configurations (<em>convention over configuration</em>), à savoir que si le développeur respecte un certain nombre de normes comme le nommage, le placement des fichiers de code, les annotations, &#8230;&#8203; il peut s&#8217;affranchir d&#8217;un grand nombre de fichiers de configuration. Spring fournit même un site dédié qui permet de générer un squelette d&#8217;application, <a href="https://start.spring.io" class="bare">https://start.spring.io</a> , connu également sous le nom de Spring Initializr.</p>
</div>
<div class="sect3">
<h4 id="spring-boot-c-est"><a class="anchor" href="#spring-boot-c-est"></a>Spring Boot c&#8217;est :</h4>
<div class="ulist">
<ul>
<li>
<p>Un outil de construction rapide de projets Spring</p>
<div class="ulist">
<ul>
<li>
<p>L’intégration des nombreux sous-projets Spring</p>
</li>
<li>
<p>La possibilité de choisir entre plusieurs technologies pour la persistance, la logique applicative ou la gestion des vues. Plusieurs technologies peuvent cohabiter</p>
</li>
<li>
<p>L’assurance de toujours avoir les bonnes dépendances</p>
</li>
<li>
<p>Etre prêt à commencer à programmer en quelques minutes</p>
</li>
</ul>
</div>
</li>
<li>
<p>Une vision convention plutôt que configuration</p>
<div class="ulist">
<ul>
<li>
<p>L’application est prévue pour fonctionner avec un ensemble cohérents de paramètres par défaut</p>
</li>
<li>
<p>La configuration et la dépendance entre beans se fait principalement par annotations</p>
</li>
<li>
<p>Utilisation de fichiers properties simples pour surcharger les paramètres par défaut</p>
</li>
<li>
<p>On peut quand même utiliser des fichiers de configuration XML en faisant un effort</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="spring-boot-n-est-pas"><a class="anchor" href="#spring-boot-n-est-pas"></a>Spring Boot n&#8217;est pas :</h4>
<div class="ulist">
<ul>
<li>
<p>Une baguette magique</p>
</li>
<li>
<p>Un outil de scaffolding</p>
</li>
<li>
<p>La solution pour ne pas apprendre les mécanismes internes de Spring</p>
</li>
<li>
<p>Un outil pour les allergiques à <em>Maven</em> et autre <em>Gradle</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="les-dépendances-d-une-application-spring-boot"><a class="anchor" href="#les-dépendances-d-une-application-spring-boot"></a>Les dépendances d&#8217;une application Spring Boot</h3>
<div class="paragraph">
<p><em>Spring Initializr</em> permet de choisir les dépendances/frameworks à utiliser pour la conception d&#8217;une application certaines dépendances sont presque indispensables à la création d&#8217;une application Web, d&#8217;autres sont optionnelles et peuvent être choisies plus tard.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Les dépendances indispensables :</p>
<div class="ulist">
<ul>
<li>
<p><code>Spring Boot DevTools</code> : permet des redémarrages rapides des applications, le rechargement temps réel des configurations pour une expérience de programmation plus fluide. Mais consomme un peu plus de ressources.</p>
</li>
<li>
<p><code>Spring Web</code> : pour construire des applications Web MVC, y compris RESTFUL. Utilise Apache Tomcat comme conteneur de servlets par défaut.</p>
</li>
<li>
<p><code>Apache Freemarker</code> ou <code>Thymeleaf</code> : un des deux moteurs de templates pour gérer les pages HTML, pas les deux en même temps autant que possible.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Les dépendances optionnelles :</p>
<div class="ulist">
<ul>
<li>
<p><code>Spring Data JPA</code> : pour gérer la persistance des données dans une base SQL</p>
</li>
<li>
<p><code>Apache Derby Database</code> ou <code>H2 Database</code> ou <code>PostgreSQL Driver</code> ou <code>MySQL Driver</code> : pour gérer les accès à une base de données SQL. Nécessaire pour <code>Spring Data JPA</code>.</p>
</li>
<li>
<p><code>Spring Security</code> : framework d&#8217;authentification et d&#8217;autorisation pour créer des applications sécurisées. Attention dès que ce composant est installé l&#8217;application demande une authentification.</p>
</li>
<li>
<p><code>Lombok</code> : un framework qui permet de s&#8217;affranchir, entre autres, des getters et des setters. Attention pour l&#8217;utiliser il vaut mieux avoir installé le plugins IntelliJ correspondant.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="générer-une-application-spring-boot"><a class="anchor" href="#générer-une-application-spring-boot"></a>Générer une application Spring Boot</h3>
<div class="paragraph">
<p>Le moyen le plus simple pour générer une application Spring Boot est de passer par le site <a href="https://start.spring.io" class="bare">https://start.spring.io</a> qui permet positionner un certain nombre de paramètres et de choisir les dépendances à utiliser.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/spring-initializr.png" alt="start.spring.io index">
</div>
</div>
<div class="paragraph">
<p>Les choix possibles :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Les paramètres de l&#8217;application :</p>
<div class="ulist">
<ul>
<li>
<p>l&#8217;outil utilisé pour gérer le projet : <code>Maven</code> ou <code>Gradle</code></p>
</li>
<li>
<p>le langage de programmation utilisés : <code>Java</code>, <code>Groovy</code> ou <code>Kotlin</code></p>
</li>
<li>
<p>La version de Spring Boot</p>
</li>
<li>
<p>Les métadonnées de l&#8217;application :</p>
<div class="ulist">
<ul>
<li>
<p>Nom du groupe : nom dns de l&#8217;organisation</p>
</li>
<li>
<p>Nom de l&#8217;artefact : nom du projet</p>
</li>
<li>
<p>Nom d&#8217;affichage du projet</p>
</li>
<li>
<p>Description du projet</p>
</li>
<li>
<p>Le type de packaging :</p>
<div class="ulist">
<ul>
<li>
<p><code>jar</code> : application indépendante avec serveur tomcat intégré</p>
</li>
<li>
<p><code>war</code> : application prête à être déployée dans un conteneur de servlets</p>
</li>
</ul>
</div>
</li>
<li>
<p>La version de <code>Java</code> : 8 ou 11 recommandées, pas 15</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Les dépendances de l&#8217;application</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="première-application"><a class="anchor" href="#première-application"></a>Première application</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="une-première-application-spring-boot"><a class="anchor" href="#une-première-application-spring-boot"></a>Une première application Spring Boot</h3>
<div class="sect3">
<h4 id="créer-le-projet"><a class="anchor" href="#créer-le-projet"></a>Créer le projet</h4>
<div class="paragraph">
<p>Dans Spring Initializr effectuez les choix suivants :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/sbi-first.png" alt="sbifirst.spring.io index">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Paramètres :</p>
<div class="ulist">
<ul>
<li>
<p>Project : Maven Project</p>
</li>
<li>
<p>Language : Java</p>
</li>
<li>
<p>Spring Boot version : 2.4.2</p>
</li>
<li>
<p>Métadonnées du projet :</p>
<div class="ulist">
<ul>
<li>
<p>Group : fr.vincimelun</p>
</li>
<li>
<p>Artifact : sbfirst</p>
</li>
<li>
<p>Name : Spring Boot First</p>
</li>
<li>
<p>Description : Première application Spring Boot</p>
</li>
<li>
<p>Package name : fr.vincimelun.sbfirst</p>
</li>
<li>
<p>Packaging : jar</p>
</li>
<li>
<p>Java (JVM) version : 11</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Dependencies :</p>
<div class="ulist">
<ul>
<li>
<p>Spring Boot DevTools</p>
</li>
<li>
<p>Spring Web</p>
</li>
<li>
<p>Apache Freemarker</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring Initilizr génére un fichier <code>.zip</code>, <code>sbfirst.zip</code>, qui contient le projet prêt à l&#8217;emploi.</p>
</div>
<div class="literalblock">
<div class="title">Arborescence du projet <code>sbfirst</code></div>
<div class="content">
<pre class="nowrap">sbfirst
├── .gitignore
├── HELP.md
├── mvnw
├── mvnw.cmd
├── pom.xml <i class="conum" data-value="1"></i><b>(1)</b>
└── src
    ├── main
    │   ├── java
    │   │   └── fr
    │   │       └── vincimelun
    │   │           └── sbfirst
    │   │               └── SpringBootFirstApplication.java <i class="conum" data-value="2"></i><b>(2)</b>
    │   └── resources
    │       ├── application.properties <i class="conum" data-value="3"></i><b>(3)</b>
    │       ├── static <i class="conum" data-value="4"></i><b>(4)</b>
    │       └── templates <i class="conum" data-value="5"></i><b>(5)</b>
    └── test
        └── java
            └── fr
                └── vincimelun
                    └── sbfirst
                        └── SpringBootFirstApplicationTests.java</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fichier <code>Maven</code> définissant le projet</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>L&#8217;application principale (fonction main)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Le fichier de configuration principal de l&#8217;application</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Le dossier pour stocker les éléments fixes comme les images ou les feuilles de style css</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Le dossier de stockage des templates Freemarker ou Thymeleaf</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La classe principale de l&#8217;application ressemble à celles qu&#8217;on peut écrire pour n&#8217;importe quelle application en mode ligne de commande : une fonction <code>main</code> statique qui permet d&#8217;instancier et de lancer l&#8217;application.</p>
</div>
<div class="listingblock">
<div class="title">Listing 1. La classe principale de l&#8217;application</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.vincimelun.sbfirst</span>;

<span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SpringBootFirstApplication</span> {

  <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) { <i class="conum" data-value="1"></i><b>(1)</b>
   SpringApplication.run(SpringBootFirstApplication.class, args); <i class="conum" data-value="2"></i><b>(2)</b>
  }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fonction <code>main</code> de l&#8217;application</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Construction et lancement de l&#8217;application</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Le fichier <code>application.properties</code> est vide, il ne contiendra que les éléments particuliers à la configuration de l&#8217;application comme les informations de connexion aux bases de données, ou la configuration du moteur de templates. Par défaut tout doit fonctionner sur les <code>conventions</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configurer-le-projet"><a class="anchor" href="#configurer-le-projet"></a>Configurer le projet</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">spring.freemarker.template-loader-path= classpath:/templates
spring.freemarker.suffix= .ftl</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="un-premier-contrôleur"><a class="anchor" href="#un-premier-contrôleur"></a>Un premier contrôleur</h4>
<div class="paragraph">
<p>Un contrôleur est une classe qui est annotée avec <code>@Controller</code> et qui contient des méthodes associées à des URI, ces methodes peuvent être associée à des annotations comme <code>@GetMapping</code>, <code>@PostMapping</code>, &#8230;&#8203; ou <code>@RequestMapping</code> plus générique. Les paramètres passés à ces méthodes sont variables et interprêtés par le moteur de Spring MVC.</p>
</div>
<div class="paragraph">
<p>Par convention les contrôleurs sont créés dans le package <code>controller</code> de l&#8217;application</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. Un contrôleur simple</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.vincimelun.sbfirst.controller</span>;

<span class="keyword">import</span> <span class="include">org.springframework.stereotype.Controller</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.GetMapping</span>;

<span class="annotation">@Controller</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MainController</span> {

    <span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> index(){
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>; <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Route correspondant pour la méthode GET et l&#8217;URI <code>/</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Nom du template associé, sans l&#8217;extention <code>.ftl</code></td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 3. Un template simple sans modèle associé</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="injectedfreemarker">&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;Bienvenue dans votre première application Spring Boot&lt;/h1&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pour passer des données au template associé à l&#8217;URI, il suffit de déclarer un objet de type <code>Model</code> dans les paramètres de la méthode. Attention cet objet est instancié par Spring, il n&#8217;y a qu&#8217;à l&#8217;utiliser. On peut considérer un objet de type <code>Model</code> comme un <code>Map</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. Exemple de gestion d&#8217;un objet <code>Model</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/avecmodele</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> withModel(Model model){ <i class="conum" data-value="1"></i><b>(1)</b>
        model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">nom</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Lagaffe</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>
        model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">profession</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Touche à tout</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">avecmodele</span><span class="delimiter">&quot;</span></span>; <i class="conum" data-value="4"></i><b>(4)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Injection d&#8217;un objet de type Model dans la méthode</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Ajout de l&#8217;attribut <code>nom</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Ajout de l&#8217;attribut <code>profession</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Nom du template qui sera fusionné avec le <code>Model</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Le template associé peut utiliser les objets <code>nom</code> et <code>profession</code> du <code>Model</code></p>
</div>
<div class="listingblock">
<div class="title">Listing 5. Template associé au <code>Model</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="injectedfreemarker">&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;Avec des données passées au template&lt;/h1&gt;
Nom : ${nom} &lt;br/&gt;
Profession : ${profession} &lt;br/&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="gérer-les-données-renvoyées-par-un-formulaire-html"><a class="anchor" href="#gérer-les-données-renvoyées-par-un-formulaire-html"></a>Gérer les données renvoyées par un formulaire HTML</h4>
<div class="paragraph">
<p>Pour récupérer les données d&#8217;un formulaire HTML ou utilise en paramètre un POJO annoté <code>@ModelAttribute</code> qui représente les données gérées par le formulaire. Par exemple si on souhaite récupérer des informations sur une personne représentée par son nom, son prénom et sa profession, il faut d&#8217;abord créer le POJO correspondant dans un package appelé <code>Model</code></p>
</div>
<div class="listingblock">
<div class="title">Listing 6. Le POJO <code>Personne</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.vincimelun.sbfirst.model</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">String</span> givenName;
    <span class="directive">private</span> <span class="predefined-type">String</span> job;

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getGivenName() {
        <span class="keyword">return</span> givenName;
    }

    <span class="directive">public</span> <span class="type">void</span> setGivenName(<span class="predefined-type">String</span> givenName) {
        <span class="local-variable">this</span>.givenName = givenName;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getJob() {
        <span class="keyword">return</span> job;
    }

    <span class="directive">public</span> <span class="type">void</span> setJob(<span class="predefined-type">String</span> job) {
        <span class="local-variable">this</span>.job = job;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ensuite il faut créer deux méthodes dans la classe <code>MainController</code> une pour afficher le formulaire et une pour récupérer les données du formulaire et les traîter (ici il s&#8217;agira juste de les afficher).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre> <span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/personne</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
 <span class="directive">public</span> <span class="predefined-type">String</span> personFormDisplay(){
   <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">personform</span><span class="delimiter">&quot;</span></span>;
 }

  <span class="annotation">@PostMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/personne</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="directive">public</span> <span class="predefined-type">String</span> personFormProcess(
      <span class="annotation">@ModelAttribute</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">persondata</span><span class="delimiter">&quot;</span></span>) Person person, <i class="conum" data-value="3"></i><b>(3)</b>
      Model model) <i class="conum" data-value="4"></i><b>(4)</b>
  {
   model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">persondisplay</span><span class="delimiter">&quot;</span></span>, person); <i class="conum" data-value="5"></i><b>(5)</b>
   <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">persondisplay</span><span class="delimiter">&quot;</span></span>;
  }</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Méthode associée à l&#8217;URI <code>/personne</code> et à la méthode GET pour afficher le formulaire</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Méhtode associée à l&#8217;URI <code>/personne</code> et à la méthode POST pour traiter le formulaire</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>L&#8217;objet associé au formulaire pour récupérer les données (voir l&#8217;explication sur le formulaire), le nom est celui de la valise <code>FORM</code> du formulaire HTML <code>persondata</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>L&#8217;objet <code>person</code> récupéré du formulaire est passé en paramètre au template d&#8217;affichage du résultat sous le nom <code>persondisplay</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Les templates associés sont les suivants</p>
</div>
<div class="listingblock">
<div class="title">Listing 7. Formulaire de saisie : personform.ftl</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td>
  <td class="code"><pre><span class="tag">&lt;html&gt;</span>
<span class="tag">&lt;body&gt;</span>
<span class="tag">&lt;h1&gt;</span>Fiche d'information<span class="tag">&lt;/h1&gt;</span>
<span class="tag">&lt;form</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/personne</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persondata</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    Nom : <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;br</span><span class="tag">/&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    Prénom : <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">givenName</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;br</span><span class="tag">/&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    Professtion : <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;br</span><span class="tag">/&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Valider</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/form&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Le nom associé au formulaire doit être le même que celui du <code>@ModelAttribute</code> dans la méthode <code>personFormProcess</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Les noms des champs doivent être les mêmes que ceux de l&#8217;objet de type <code>Person</code> annoté par <code>@ModelAttribute</code></td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 8. Affichage des données</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td>
  <td class="code"><pre><span class="tag">&lt;html&gt;</span>
<span class="tag">&lt;body&gt;</span>
<span class="tag">&lt;h1&gt;</span>Fiche personnelle<span class="tag">&lt;/h1&gt;</span>
<span class="tag">&lt;ul&gt;</span>
    <span class="tag">&lt;li&gt;</span>Nom : ${persondisplay.name}<span class="tag">&lt;/li&gt;</span>
    <span class="tag">&lt;li&gt;</span>Prenom : ${persondisplay.givenName}<span class="tag">&lt;/li&gt;</span>
    <span class="tag">&lt;li&gt;</span>Profession : ${persondisplay.job}<span class="tag">&lt;/li&gt;</span>
<span class="tag">&lt;/ul&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="code-httpservletrequest-code-et-code-httpservletresponse-code"><a class="anchor" href="#code-httpservletrequest-code-et-code-httpservletresponse-code"></a><code>HttpServletRequest</code> et <code>HttpServletResponse</code></h4>
<div class="paragraph">
<p>Les objets <code>HttpServletRequest</code>, particulièrement utiles pour récupérer la session de l&#8217;utilisateur, et <code>HttpServletResponse</code> pour positionner les en-têtes HTTP sont toujours disponibles, il suffit de les déclarer en paramètre de la méthode contrôleur.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="exercices"><a class="anchor" href="#exercices"></a>Exercices</h3>
<div class="sect3">
<h4 id="todo"><a class="anchor" href="#todo"></a>ToDo</h4>
<div class="paragraph">
<p>Reprendre l&#8217;exercice sur les ToDos du cours sur les servlets et l&#8217;adapter à Spring Boot. Pour cet exercice vous vous contenterez de créer une classe Controller nommée <code>ToDoController</code> que vous ajouterez au projet existant et qui gère l&#8217;URI <code>/todo</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="nagioscfg"><a class="anchor" href="#nagioscfg"></a>NagiosCfg</h4>
<div class="paragraph">
<p>Reprendre l&#8217;exercice sur la génrération de fichiers de configuration Nagios et l&#8217;adapter à Spring Boot. Vous trouverez un corrigé version servlets en suivant le lien <a href="https://github.com/ocapuozzo/tomcat-switch-log" class="bare">https://github.com/ocapuozzo/tomcat-switch-log</a> . Pour cet exercice vous créerez un projet depuis <code>Spring Initializr</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction-à-jpa"><a class="anchor" href="#introduction-à-jpa"></a>Introduction à JPA</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="présentation"><a class="anchor" href="#présentation"></a>Présentation</h3>
<div class="paragraph">
<p>JPA est une interface de programmation permettant d&#8217;utiliser un modèle objet
au-dessus d&#8217;une base de données relationnelle.</p>
</div>
<div class="paragraph">
<p>JPA associe un graphe de classes Java aux tables d&#8217;une base de données
relationnelle par le biais :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>de fichiers de configuration xml</p>
</li>
<li>
<p>d&#8217;annotations depuis Java 5 (c&#8217;est la méthode préférée)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pour la suite nous utiliserons le modèle suivant :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diag-a914caedbcc6bf866b70a096ee7c6f76.png" alt="Modèle d'analyse du domaine" width="532" height="201">
</div>
<div class="title">Figure 1. Modèle d&#8217;analyse du domaine</div>
</div>
<div class="paragraph">
<p>Dans ce modèle un acteur peut avoir plusieurs rôles dans un film, ce n&#8217;est pa courant, mais ça arrive : dans "Docteur Folamour" Peter Sellers joue à la fois Colonel Lionel Mandrake, Président Merkin Muffley et Docteur Folamour.</p>
</div>
<div class="paragraph">
<p>Parfois, la base de données préexiste à l&#8217;application à développer.</p>
</div>
<div class="paragraph">
<p>Par exemple, voici un schéma d&#8217;une base de données, défini dans le dialecte H2, en phase avec le modèle d&#8217;analyse :</p>
</div>
<div class="listingblock">
<div class="title">Listing 9. Script SQL de la base cinema</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> PERSONS
(
    ID <span class="predefined-type">BIGINT</span> <span class="directive">AUTO_INCREMENT</span> <span class="directive">PRIMARY</span> <span class="type">KEY</span> <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
    SURNAME <span class="predefined-type">VARCHAR</span>(<span class="integer">60</span>) <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
    GIVENNAME <span class="predefined-type">VARCHAR</span>(<span class="integer">40</span>),
    BIRTH_YEAR <span class="predefined-type">INTEGER</span>,
    IMAGE_PATH <span class="predefined-type">VARCHAR</span>(<span class="integer">80</span>)
);

<span class="class">CREATE</span> <span class="type">TABLE</span> FILMS
(
    ID <span class="predefined-type">BIGINT</span> <span class="directive">AUTO_INCREMENT</span> <span class="directive">PRIMARY</span> <span class="type">KEY</span> <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
    TITLE <span class="predefined-type">VARCHAR</span>(<span class="integer">50</span>),
    RATING <span class="predefined-type">DECIMAL</span>(<span class="integer">2</span>,<span class="integer">1</span>),
    IMAGE_PATH <span class="predefined-type">VARCHAR</span>(<span class="integer">120</span>),
    SUMMARY CLOB,
    FILM_DIRECTOR <span class="predefined-type">BIGINT</span>,
    <span class="type">CONSTRAINT</span> FILMS_PERSONS_ID_FK <span class="directive">FOREIGN</span> <span class="type">KEY</span> (FILM_DIRECTOR)
        <span class="keyword">REFERENCES</span> PERSONS (ID)
);

<span class="class">CREATE</span> <span class="type">TABLE</span> PLAY
(
    ID <span class="predefined-type">BIGINT</span> <span class="directive">AUTO_INCREMENT</span> <span class="directive">PRIMARY</span> <span class="type">KEY</span> <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
    PERSON_ID <span class="predefined-type">BIGINT</span> <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
    FILM_ID <span class="predefined-type">BIGINT</span> <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
    RANK <span class="predefined-type">INTEGER</span> <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
    NAME <span class="predefined-type">VARCHAR</span>(<span class="integer">90</span>),
    <span class="type">CONSTRAINT</span> PLAY___FK_PERSON <span class="directive">FOREIGN</span> <span class="type">KEY</span> (PERSON_ID)
        <span class="keyword">REFERENCES</span> PERSONS (ID) <span class="keyword">ON</span> <span class="class">DELETE</span> <span class="directive">CASCADE</span> <span class="keyword">ON</span> <span class="class">UPDATE</span> <span class="directive">CASCADE</span>,
    <span class="type">CONSTRAINT</span> PLAY_FILMS_ID_FK <span class="directive">FOREIGN</span> <span class="type">KEY</span> (FILM_ID)
        <span class="keyword">REFERENCES</span> FILMS (ID)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Une application JPA se divise en deux parties :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Définir le modèle de données (graphe d&#8217;objets)</p>
</li>
<li>
<p>Gérer l&#8217;accès aux données (créer, récupérer, modifier et supprimer les données)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="définir-le-modèle"><a class="anchor" href="#définir-le-modèle"></a>Définir le modèle</h3>
<div class="sect3">
<h4 id="une-traduction-de-l-analyse"><a class="anchor" href="#une-traduction-de-l-analyse"></a>Une traduction de l&#8217;analyse</h4>
<div class="paragraph">
<p>Le modèle qui nous intéresse ici est celui centré sur la logique métier du client, les données qu&#8217;ils manipulent. Ces données sont regroupées en <strong>entités</strong>, qui, dans le code, sont représentées par des <strong>classes</strong>, dites <strong>métier</strong>, parfois stéréotypées &lt;&lt;entity&gt;&gt; dans les diagrammes d&#8217;analyse.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Il est fort pratique de représenter l&#8217;analyse sous la forme d&#8217;un diagramme de classes UML, car, en conception (design), l&#8217;analyse permet au développeur de se consacrer sur les détails des entités sans perdre le fil de leurs relations.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="associer-une-table-à-une-classe-les-entités-entities"><a class="anchor" href="#associer-une-table-à-une-classe-les-entités-entities"></a>Associer une table à une classe, les entités (entities)</h4>
<div class="listingblock">
<div class="title">Listing 10. Classe Person associée à la table PERSONS (sans référence à d&#8217;autres entités)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.vincimelun.cinemajpa.model</span>;

<span class="keyword">import</span> <span class="include">javax.persistence</span>.*;
<span class="keyword">import</span> <span class="include">java.util.Collection</span>;
<span class="keyword">import</span> <span class="include">java.util.Objects</span>;

<span class="annotation">@Entity</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">PERSONS</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Personne</span>
{
    <span class="annotation">@Id</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="annotation">@GeneratedValue</span>(strategy = GenerationType.IDENTITY) <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">false</span>)
    <span class="directive">private</span> <span class="type">long</span> id; <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="annotation">@Basic</span> <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">SURNAME</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">false</span>, length = <span class="integer">60</span>) <i class="conum" data-value="7"></i><b>(7)</b>
    <span class="directive">private</span> <span class="predefined-type">String</span> nom;
    <span class="annotation">@Basic</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">GIVENNAME</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">true</span>, length = <span class="integer">40</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> prenom;
    <span class="annotation">@Basic</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">BIRTH_YEAR</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">true</span>)
    <span class="directive">private</span> <span class="predefined-type">Integer</span> anneeNaissance;
    <span class="annotation">@Basic</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">IMAGE_PATH</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">true</span>, length = <span class="integer">80</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> photo;

    <span class="directive">public</span> <span class="type">long</span> getId() {
        <span class="keyword">return</span> id;
    }

    <span class="directive">public</span> <span class="type">void</span> setId(<span class="type">long</span> id) {
        <span class="local-variable">this</span>.id = id;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getNom() {
        <span class="keyword">return</span> nom;
    }

    <span class="directive">public</span> <span class="type">void</span> setNom(<span class="predefined-type">String</span> surname) {
        <span class="local-variable">this</span>.nom = surname;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getPrenom() {
        <span class="keyword">return</span> prenom;
    }

    <span class="directive">public</span> <span class="type">void</span> setPrenom(<span class="predefined-type">String</span> givenname) {
        <span class="local-variable">this</span>.prenom = givenname;
    }

    <span class="directive">public</span> <span class="predefined-type">Integer</span> getAnneeNaissance() {
        <span class="keyword">return</span> anneeNaissance;
    }

    <span class="directive">public</span> <span class="type">void</span> setAnneeNaissance(<span class="predefined-type">Integer</span> birthYear) {
        <span class="local-variable">this</span>.anneeNaissance = birthYear;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getPhoto() {
        <span class="keyword">return</span> photo;
    }

    <span class="directive">public</span> <span class="type">void</span> setPhoto(<span class="predefined-type">String</span> imagePath) {
        <span class="local-variable">this</span>.photo = imagePath;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> o) {
        <span class="keyword">if</span> (<span class="local-variable">this</span> == o) <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        <span class="keyword">if</span> (o == <span class="predefined-constant">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        Personne that = (Personne) o;
        <span class="keyword">return</span> id == that.id &amp;&amp;
                Objects.equals(nom, that.nom) &amp;&amp;
                Objects.equals(prenom, that.prenom) &amp;&amp;
                Objects.equals(anneeNaissance, that.anneeNaissance) &amp;&amp;
                Objects.equals(photo, that.photo);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> hashCode() {
        <span class="keyword">return</span> Objects.hash(id, nom, prenom, anneeNaissance, photo);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Personne{</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">nom='</span><span class="delimiter">&quot;</span></span> + nom + <span class="string"><span class="delimiter">'</span><span class="char">\'</span><span class="delimiter">'</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">, prenom='</span><span class="delimiter">&quot;</span></span> + prenom + <span class="string"><span class="delimiter">'</span><span class="char">\'</span><span class="delimiter">'</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">, anneeNaissance=</span><span class="delimiter">&quot;</span></span> + anneeNaissance +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">, photo='</span><span class="delimiter">&quot;</span></span> + photo + <span class="string"><span class="delimiter">'</span><span class="char">\'</span><span class="delimiter">'</span></span> +
                <span class="string"><span class="delimiter">'</span><span class="content">}</span><span class="delimiter">'</span></span>;
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@Entity</code> déclare la classe comme un objet persistant
associé par défaut à la table de même nom (à la casse près).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@Table</code> déclare le nom de la table associée à la classe, indispensable
si les deux noms diffèrent comme c&#8217;est le cas ici.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@Id</code> déclare l&#8217;attibut comme clé primaire, au moins un attribut doit
être marqué par cette annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>@GeneratedValue</code> indique que la valeur est générée automatiquement
par le SGBD</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>L&#8217;attribut associé à la propriété, l&#8217;annotation se fait soit sur les
getters, soit sur les attributs, mais on ne mélange pas les styles. De préférence on annote les attributs, ça facilite la lecture de la classe.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>@Basic</code> désigne une propriété associée à un type de base.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>@Column</code> permet d&#8217;établir la correspondance entre la propriété de la classe
et la colonne de la table, ainsi que certaines règles de validation commme
l&#8217;interdiction de nullité, la longueur, le type&#8230;&#8203;</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="gérer-les-associations-un-vers-plusieurs-code-manytoone-code-et-code-onetomany-code"><a class="anchor" href="#gérer-les-associations-un-vers-plusieurs-code-manytoone-code-et-code-onetomany-code"></a>Gérer les associations un vers plusieurs (<code>ManyToOne</code> et <code>OneToMany</code>)</h4>
<div class="paragraph">
<p>Dans le modèle un film a un réalisateur et un seul alors qu&#8217;une personne peut avoir réalisé plusieurs films.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diag-592e2b88d062e3594c70a879cdf2d2cb.png" alt="diag 592e2b88d062e3594c70a879cdf2d2cb" width="390" height="114">
</div>
</div>
<div class="paragraph">
<p>L&#8217;association de <code>Film</code> vers <code>Personne</code> est de type <code>ManyToOne</code>. Cette même association vue côté <code>Personne</code> est de type <code>OneToMany</code> vers <code>Film</code>.</p>
</div>
<div class="paragraph">
<p>Si l&#8217;association est bidirectionnelle, la classe côté <code>ManyToOne</code> (dans notre cas <code>Film</code>) est dite propriétaire (<em>owner</em>) de l&#8217;association car sa table associée détient la clé étrangère de la relation. Le côté non propriétaire, ici <code>Personne</code>, doit utiliser l&#8217;élément <em>mappedBy</em> de l&#8217;annotation pour spécifier l&#8217;attribut du côté propriétaire. Pour les données en base, le système assure la cohérence des liens entre objets en mémoire. Par contre, en cas gestion mémoire de ces liens par la logique applicative, la cohérence est du ressort du développeur.</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. La classe Film sans les méthodes</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.vincimelun.cinemajpa.model</span>;


<span class="keyword">import</span> <span class="include">javax.persistence</span>.*;
<span class="keyword">import</span> <span class="include">java.math.BigDecimal</span>;
<span class="keyword">import</span> <span class="include">java.util.Collection</span>;
<span class="keyword">import</span> <span class="include">java.util.Objects</span>;

<span class="annotation">@Entity</span>
<span class="annotation">@Table</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">FILMS</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Film</span> {
    <span class="annotation">@Id</span>
    <span class="annotation">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">false</span>)
    <span class="directive">private</span> <span class="type">long</span> id;
    <span class="annotation">@Basic</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">TITLE</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">true</span>, length = <span class="integer">50</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> titre;
    <span class="annotation">@Basic</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">RATING</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">true</span>, precision = <span class="integer">1</span>)
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> note;
    <span class="annotation">@Basic</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">IMAGE_PATH</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">true</span>, length = <span class="integer">120</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> afficheNom;
    <span class="annotation">@Basic</span>
    <span class="annotation">@Lob</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">SUMMARY</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">true</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> resume;
    <span class="annotation">@ManyToOne</span>(fetch = FetchType.EAGER) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">FILM_DIRECTOR</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">private</span> Personne realisateur; <i class="conum" data-value="3"></i><b>(3)</b>

    ...

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>L&#8217;annotation <code>@ManyToOne</code> permet de savoir que l&#8217;objet annoté doit être retrouvé dans une autre table. Le paramètre <code>FetchType</code> permet de savoir s&#8217;il faut immédiatement retrouver l&#8217;objet lié (<code>EAGER</code>) ou s&#8217;il faut le retrouver seulement lorsqu&#8217;il est accédé dans l&#8217;application (<code>LAZY</code>). La deuxième option diffère la requête SQL jusqu&#8217;à ce que l&#8217;application cherche à accéder à l&#8217;objet Personne</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>L&#8217;annotation <code>@JoinColumn</code> permet à l&#8217;application de déterminer quelle colonne dans la table sert de clé étrangère pour retrouver l&#8217;objet lié</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Si <code>FILM_DIRECTOR</code> est une clé étrangère et un entier, l&#8217;objet associé est lui de type Personne. Avec JPA le développeur gère un graphe d&#8217;objets, pas une base de données SQL.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 12. La classe Person sans les méthodes</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.vincimelun.cinemajpa.model</span>;

<span class="keyword">import</span> <span class="include">javax.persistence</span>.*;
<span class="keyword">import</span> <span class="include">java.util.Collection</span>;
<span class="keyword">import</span> <span class="include">java.util.Objects</span>;

<span class="annotation">@Entity</span>
<span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">PERSONS</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Personne</span>
{
    <span class="annotation">@Id</span>
    <span class="annotation">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">false</span>)
    <span class="directive">private</span> <span class="type">long</span> id;
    <span class="annotation">@Basic</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">SURNAME</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">false</span>, length = <span class="integer">60</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> nom;
    <span class="annotation">@Basic</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">GIVENNAME</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">true</span>, length = <span class="integer">40</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> prenom;
    <span class="annotation">@Basic</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">BIRTH_YEAR</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">true</span>)
    <span class="directive">private</span> <span class="predefined-type">Integer</span> anneeNaissance;
    <span class="annotation">@Basic</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">IMAGE_PATH</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">true</span>, length = <span class="integer">80</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> photo;
    <span class="annotation">@OneToMany</span>(cascade= CascadeType.ALL, mappedBy = <span class="string"><span class="delimiter">&quot;</span><span class="content">realisateur</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">private</span> <span class="predefined-type">Collection</span>&lt;Film&gt; filmsRealises; <i class="conum" data-value="2"></i><b>(2)</b>

    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@OneToMany</code> indique qu&#8217;une instance de Personne peut être liée à plusieurs instances de Film en tant que réalisateur, c&#8217;est l&#8217;objet <code>realisateur</code> dans Film qui représente ce lien</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Comme une personne peut avoir réalisé plusieurs films, ces films sont stockés dans une collection qui peut être vide si la personne n&#8217;a réalisé aucun film.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gérer-l-accès-aux-données-les-dépôts-repositories"><a class="anchor" href="#gérer-l-accès-aux-données-les-dépôts-repositories"></a>Gérer l&#8217;accès aux données, les dépôts (repositories)</h3>
<div class="sect3">
<h4 id="présentation-2"><a class="anchor" href="#présentation-2"></a>Présentation</h4>
<div class="paragraph">
<p>Si les classes Entity permettent de définir les structures de données et la façon dont les objets sont liés aux tables SQL, elles ne permettent pas de manipuler les tables : créer, lire, mettre à jour ou supprimer des données. En anglais ces actions sont connues sous le nom de <code>CRUD</code> (Create, Read, Update, Delete). Les objets qui permettent de faire des opérations de type <code>CRUD</code> sur une base de données sont appelés des DAO (Data Access Object).</p>
</div>
<div class="paragraph">
<p>Créer des DAOs est une tâche répétitive et ingrate, 90% du code est
similaire d&#8217;un DAO à l&#8217;autre. Spring propose une méthode standard pour
gérer les DAOs au travers d&#8217;objets, ou plutôt d&#8217;interfaces, de type
<code>CrudRepository</code>, <code>PagingAndSortingRepository
` ou `JpaRepository</code> qui hérite de la classe précédente. Dans les cas simples <code>CrudRepository</code> suffit largement.</p>
</div>
</div>
<div class="sect3">
<h4 id="l-interface-crudrepository"><a class="anchor" href="#l-interface-crudrepository"></a>L&#8217;interface CrudRepository</h4>
<div class="paragraph">
<p>Permet d&#8217;effectuer toutes les opérations de base d&#8217;un DAO :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>long count()</code> : compte le nombre d&#8217;entités disponibles</p>
</li>
<li>
<p><code>void delete(T entity)</code> : supprime l&#8217;entité passée en paramètre</p>
</li>
<li>
<p><code>void deleteAll()</code> : supprime toutes les entités</p>
</li>
<li>
<p><code>void deleteById(ID id)</code> : supprime une entité avec l&#8217;id passé en paramètre</p>
</li>
<li>
<p><code>void existsById(ID id)</code> : retourne vrai si une entité avec l&#8217;id passé en paramètre existe</p>
</li>
<li>
<p><code>Iterable&lt;T&gt; findAll()</code> : retourne toutes les instances du type</p>
</li>
<li>
<p><code>Iterable&lt;T&gt; findAllById(Iterable&lt;ID&gt; id)</code> :</p>
</li>
<li>
<p><code>Optional&lt;T&gt; findById(ID id)</code> : retrouve une entité par son id</p>
</li>
<li>
<p><code>&lt;S extends T&gt; S save(S entity)</code> : sauvegarde une entité donnée</p>
</li>
<li>
<p><code>&lt;S extends T&gt; Iterable&lt;S&gt; saveAll(Iterable&lt;S&gt; entities)</code> : sauvegarde toutes les entités passées en paramètre.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ci-dessous un exemple de CrudRepository :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.vincimelun.cinemajpa.dao</span>;

<span class="keyword">import</span> <span class="include">org.springframework.data.repository.CrudRepository</span>;
<span class="keyword">import</span> <span class="include">org.vincimelun.cinemajpa.model.Personne</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">PersonneRepository</span> <span class="directive">extends</span> CrudRepository&lt;Personne, <span class="predefined-type">Long</span>&gt; {
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configurer-un-projet-spring-boot-pour-utiliser-jpa"><a class="anchor" href="#configurer-un-projet-spring-boot-pour-utiliser-jpa"></a>Configurer un projet Spring Boot pour utiliser JPA</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"># Configuration de Freemarker
spring.freemarker.template-loader-path= classpath:/templates
spring.freemarker.suffix= .ftl

# Connexion à la base de données
spring.datasource.url=jdbc:h2:file:c:/db/cinema;AUTO_SERVER=true <i class="conum" data-value="1"></i><b>(1)</b>
#spring.datasource.url=jdbc:h2:file:~/db/cinema;AUTO_SERVER=true <i class="conum" data-value="2"></i><b>(2)</b>
spring.datasource.driver-class-name=org.h2.Driver <i class="conum" data-value="3"></i><b>(3)</b>
spring.datasource.username=sa <i class="conum" data-value="4"></i><b>(4)</b>
spring.datasource.password= <i class="conum" data-value="5"></i><b>(5)</b>
spring.jpa.hibernate.ddl-auto=create-drop <i class="conum" data-value="6"></i><b>(6)</b>
spring.datasource.initialization-mode=always <i class="conum" data-value="7"></i><b>(7)</b>
spring.h2.console.enabled=true <i class="conum" data-value="8"></i><b>(8)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Chaîne JDBC de connexion à la base de données, version Windows</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>La même version Linux ou Mac. <code>;AUTO_SERVER=true</code> permet une connexion par des tiers comme intellij&#8230;&#8203; (H2 mixed mode)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Driver JDBC à utiliser</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Utilisateur pour accéder à la source de données JDBC</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Mot de passe de l&#8217;utlisateur</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Le schéma de la base de données est généré à partir des entités JPA, à chaque exécution de l&#8217;application les tables sont supprimées et recrées, l&#8217;option <code>create-drop</code> n&#8217;est valable que pour la phase de développement, en production on utilise l&#8217;option <code>none</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Si un fichier `data.sql`est présent, il est automatiquement utilisé pour importer les données qu&#8217;il contient dans la base de données</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Permet d&#8217;accéder à la console H2 une fois que l&#8217;application est lancée à l&#8217;URL <code><a href="http://localhost:8080/h2-console" class="bare">http://localhost:8080/h2-console</a></code>, il s&#8217;agit d&#8217;une application web intégrée au moteur H2 permettant de manipuler la base de données</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/data-source-idea-h2.png" alt="data-source-idea-h2.png">
</div>
<div class="title">Figure 2. Exemple de connexion à H2 avec intellij</div>
</div>
</div>
<div class="sect2">
<h3 id="travail-à-faire"><a class="anchor" href="#travail-à-faire"></a>Travail à faire</h3>
<div class="paragraph">
<p>A partir du projet <code>cinemajpa</code> présent sur la clé :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reprendre l&#8217;application les templates que vous aves créé pour l&#8217;application <code>cinema</code> de la semaine dernière et créez la partie contrôleur de <code>cinemajpa</code></p>
</li>
<li>
<p>Pour l&#8217;entité Personne créez un formulaire qui permette de créer ou de modifier une personne, pour la photo d&#8217;une nouvelle personne vous utliserez pour l&#8217;instant l&#8217;image de substitution <code>person.png</code></p>
</li>
<li>
<p>Même chose pour les films, mais en utilisant cette fois <code>poster.png</code> comme image de substitution</p>
</li>
<li>
<p>Enfin imaginez une interface permettant de gérer les rôles associés à un film.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction-layout-avec-thymleaf"><a class="anchor" href="#introduction-layout-avec-thymleaf"></a>Introduction (layout avec thymleaf)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="présentation-3"><a class="anchor" href="#présentation-3"></a>Présentation</h3>
<div class="paragraph">
<p>Lorsqu&#8217;une application web est constituée de plusieurs <em>pages</em>,  il est alors
de bon usage de conserver une unité de représentation.</p>
</div>
<div class="paragraph">
<p>Techniquement, cette unité de représentation se base sur :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>un <strong>modèle</strong>, connu sous le nom de <em>template</em> ou <em>layout</em> (structuration HTML).</p>
</li>
<li>
<p>un ensemble de règles CSS partagées par l&#8217;ensemble des pages</p>
</li>
<li>
<p>[des dépendances de bibliothèques js]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En phase de prototypage, il est fréquent de s&#8217;appuyer sur des frameworks CSS (par exemples <a href="https://getbootstrap.com/">Bootstrap</a>, <a href="https://bulma.io/">bulma</a> )</p>
</div>
<div class="paragraph">
<p>Ces solutions intègrent de nombreux composants CSS et JS. Ces composants sont destinés au tiers client (navigateur, smartphone&#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>Il existe 2 solutions pour distribuer ces composants aux clients tiers :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>donner aux clients un lien sur le réseau de contenu (<em>CDN content delivery network</em>), pour téléchargement, par exemple <a href="http://code.jquery.com/jquery-3.3.1.js" class="bare">http://code.jquery.com/jquery-3.3.1.js</a></p>
</li>
<li>
<p>servir ces composants à partir du serveur web de l&#8217;application (communication HTTP entre le serveur HTTP de l&#8217;application et les clients), par exemple <a href="http://monapplication.com/js/jquery-3.3.1.js" class="bare">http://monapplication.com/js/jquery-3.3.1.js</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dans le cadre d&#8217;une application à faible diffusion, la deuxième solution peut être envisagée, de plus elle a le mérite d&#8217;assurer la disponibilité des composants (si l&#8217;application est disponible, alors ses composants le sont aussi), et, accessoirement, permet au développeur de travailler hors ligne.</p>
</div>
</div>
<div class="sect2">
<h3 id="webjars-une-solution-java"><a class="anchor" href="#webjars-une-solution-java"></a>webjars - une solution java</h3>
<div class="paragraph">
<p>Nous nous placons dans le cas où c&#8217;est l&#8217;application qui héberge les composants dont auront besoin ses tiers clients.</p>
</div>
<div class="paragraph">
<p>Initialement, l&#8217;application devra donc les obtenir (elle utilisera CDN pour l&#8217;occasion). Elle pourrait pour cela utiliser des gestionnaires de version spécilisés comme <em>npm</em>, <em>yarn</em>, <em>bower</em>&#8230;&#8203;),
mais il serait dommage de ne pas profiter du gestionnaire de version <em>maven</em> ! C&#8217;est ce que permet la solution <a href="http://www.webjars.org/">webjars</a>, qui encapsule les composants client dans un jar. Tout cela se passe côté serveur bien entendu.</p>
</div>
<div class="paragraph">
<p>Les WebJars sont des librairies à destination des clients-web (par exemple jQuery &amp; Bootstrap), packagées dans un fichier JAR (Java Archive), et disponible via divers gestionnaires d&#8217;automatisation de taches, comme <em>maven</em> par exemple.</p>
</div>
<div class="paragraph">
<p><a href="https://www.webjars.org/documentation" class="bare">https://www.webjars.org/documentation</a></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/webjars-bt.png" alt="webjars-bt"></span></p>
</div>
<div class="paragraph">
<p>La définition de la dépendance devra être copiée dans le fichier <strong>pom.xml</strong> du projet. C&#8217;est à partir de cette référence que <strong>maven</strong> téléchargera dans son dépot local les fichiers en question, et rendra accessibles ces fichiers en les plaçant dans le <em>CLASSPATH</em> du projet (ce qui les rendra accessible à l&#8217;IDE).</p>
</div>
</div>
<div class="sect2">
<h3 id="webjars-cas-bootstrap"><a class="anchor" href="#webjars-cas-bootstrap"></a>webjars - cas bootstrap</h3>
<div class="listingblock">
<div class="title">Listing 13. pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  [...]

 <span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>org.webjars<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>bootstrap<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>4.1.3<span class="tag">&lt;/version&gt;</span>
 <span class="tag">&lt;/dependency&gt;</span>

 <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.webjars/jquery --&gt;</span>
 <span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>org.webjars<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>jquery<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>3.3.1-1<span class="tag">&lt;/version&gt;</span>
 <span class="tag">&lt;/dependency&gt;</span>

<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ces déclarations de dépendances, lorsqu&#8217;elle seront évaluées par <em>maven</em>, provoqueront le
rapatriement, sur la machine hôte, des ressources inscrites dans le <em>webjars</em>.
Ces ressources seront alors accessibles au projet, via l&#8217;IDE, au même titre que des librairies java.</p>
</div>
<div class="paragraph">
<p>Le développeur pourra donc y faire références à la conception des vues.</p>
</div>
</div>
<div class="sect2">
<h3 id="layout-cas-thymeleaf"><a class="anchor" href="#layout-cas-thymeleaf"></a>layout - cas thymeleaf</h3>
<div class="paragraph">
<p>Avec <em>thymeleaf</em>, la conception d&#8217;un modèle de présentation (<strong>layout</strong> ou <strong>template</strong>)
est basée sur la décomposition du modèle en <strong>fragments</strong>.</p>
</div>
<div class="paragraph">
<p>Voici une organisation typique de ressources liées à la logique de présentation:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>├── application.properties
├── static
│   └── css
│       └── main.css <i class="conum" data-value="1"></i><b>(1)</b>
└── templates
    ├── admin <i class="conum" data-value="2"></i><b>(2)</b>
    │   └── index.html <i class="conum" data-value="3"></i><b>(3)</b>
    ├── error
    │   └── 403.html
    ...
    ├── fragments
    │   ├── footer.html <i class="conum" data-value="4"></i><b>(4)</b>
    │   └── header.html
    └─ index.html</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>pour la redéfinition de règles héritées, propre à l&#8217;application</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>en référence au rôle utilisateur prioritairement concerné (ici un <code>admin</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>les vues des controleurs sont placées dans un dossier portant le nom racine d&#8217;un contrôleur (AdminController)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>les fichiers déclarant des <strong>fragments</strong> (parties réutilisées par les vues) sont logés dans le dossier <em>fragments</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Les différentes pages partagent toutes les mêmes parties <code>header</code> (parties &lt;head&gt; et menu) et <code>footer</code>.</p>
</div>
<div class="paragraph">
<p>Voici un exemple d&#8217;utilisation :</p>
</div>
<div class="listingblock">
<div class="title">Listing 14. admin/index.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE HTML&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;title&gt;</span>Page Admin<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">th:replace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fragments/header :: header-css (title='Admin')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>

<span class="tag">&lt;div</span> <span class="attribute-name">th:replace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fragments/header :: header</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>

<span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

     <span class="tag">&lt;h1&gt;</span>Admin index<span class="tag">&lt;/h1&gt;</span>

<span class="tag">&lt;/div&gt;</span>
<span class="comment">&lt;!-- /.container --&gt;</span>

<span class="tag">&lt;div</span> <span class="attribute-name">th:replace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fragments/footer:: footer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>

<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>insertion du fragment <em>header-css</em> (définit dans le fichier <em>header.html</em>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>insertion du fragment <em>header</em> (définit dans le fichier <em>header.html</em>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>insertion du fragment <em>footer</em> (définit dans le fichier <em>footer.html</em>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Voyons maintenant des exemples de composants <em>fragment</em></p>
</div>
<div class="listingblock">
<div class="title">Listing 15. footer.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:sec</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org/thymeleaf-extras-springsecurity4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;head&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">th:fragment</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">footer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;footer&gt;</span>
        <span class="entity">&amp;copy;</span> 2021 myapplication.com
    <span class="tag">&lt;/footer&gt;</span>

    <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/javascript</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/webjars/bootstrap/4.1.3/js/bootstrap.min.js</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="attribute-name">th:src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@{/webjars/bootstrap/4.1.3/js/bootstrap.min.js}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="inline">    </span><span class="tag">&lt;/script&gt;</span>

    <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/javascript</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/webjars/jquery/3.3.1-1/jquery.min.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">            th:src=<span class="string"><span class="delimiter">&quot;</span><span class="content">@{/webjars/jquery/3.3.1-1/jquery.min.js}</span><span class="delimiter">&quot;</span></span></span>
            <span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Un composant est en fait le body d&#8217;une page HTML particulière, comportant une déclaration de fragment.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Ceci est un exemple (la doc thymleaf parle de <em>prototype</em>). Sous IntelliJ, pensez à utiliser la complétion automatique (ctrl+ esp) pour l&#8217;expression de chemin.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>C&#8217;est la valeur <em>src</em> qui sera appliquée. Les expressions thymleaf de chemin ou de lien sont encadrées  par <code>@{ &#8230;&#8203; }</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 16. header.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;html</span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;head&gt;</span>
   <span class="tag">&lt;th:block</span> <span class="attribute-name">th:fragment</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">header-css</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="tag">&lt;link</span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheet</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/css</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/webjars/bootstrap/4.1.3/css/bootstrap.min.css</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="attribute-name">th:href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@{/webjars/bootstrap/4.1.3/css/bootstrap.min.css}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>

      <span class="tag">&lt;link</span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheet</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@{/css/main.css}</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">../static/css/main.css</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

      <span class="tag">&lt;title</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${title ?: 'Default title'}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/title&gt;</span> <i class="conum" data-value="5"></i><b>(5)</b>

   <span class="tag">&lt;/th:block&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">th:fragment</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="tag">&lt;nav</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">navbar navbar-inverse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">navbar-header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;a</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">navbar-brand</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@{/}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Spring Boot<span class="tag">&lt;/a&gt;</span>
            <span class="tag">&lt;/div&gt;</span>
            <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">navbar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">collapse navbar-collapse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;ul</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nav navbar-nav</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">active</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">th:href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@{/}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Home<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/li&gt;</span>
                <span class="tag">&lt;/ul&gt;</span>
            <span class="tag">&lt;/div&gt;</span>
        <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;/nav&gt;</span>
<span class="tag">&lt;/div&gt;</span>

<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>déclaration d&#8217;un fragment nommé <em>header-css</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>prototype de lien bootstrap</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>expression du lien th:href</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>le fichier CSS pour les redéfinitions propres à l&#8217;application (ne pas faire référence au dossier <code>static</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>définition de la valeur de <code>&lt;title&gt;</code> avec valeur par défaut (opérateur elvis)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>déclaration d&#8217;un autre fragment dans le même fichier</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="controleur"><a class="anchor" href="#controleur"></a>Controleur</h3>
<div class="paragraph">
<p>Voici un exemple de mise en oeuvre, à minima :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="comment">// AdminController</span>

  <span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/admin</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">public</span> <span class="predefined-type">String</span> admin() {
     <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/admin/index</span><span class="delimiter">&quot;</span></span>;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nous avons ici rangé les vues dans des dossiers
portant le nom du rôle prioritairement concerné, un parti pris.</p>
</div>
</div>
<div class="sect2">
<h3 id="documentation"><a class="anchor" href="#documentation"></a>Documentation</h3>
<div class="ulist">
<ul>
<li>
<p>Documentation générale :  <a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">thymeleaf documenataion</a></p>
</li>
<li>
<p>Ne pas passer à côté des classes utilitaires : <a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#appendix-b-expression-utility-objects">classes utilitaires - avec exemples</a></p>
</li>
<li>
<p>Différentes façons d&#8217;inclure un fragment : <a href="http://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#including-template-fragments">thymeleaf:insclusion de fragments</a></p>
</li>
<li>
<p>Paramétrer un fragment : <a href="http://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#parameterizable-fragment-signatures">fragment paramétré</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="internationalisation"><a class="anchor" href="#internationalisation"></a>Internationalisation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="présentation-4"><a class="anchor" href="#présentation-4"></a>Présentation</h3>
<div class="paragraph">
<p>Dans un monde où l&#8217;interconnexion ne connait, bien souvent, aucune frontière,
il est opportun, pour une application web à large public, de pouvoir
adapter son IHM à la langue de ses utilisateurs.</p>
</div>
<div class="paragraph">
<p>Les frameworks sont généralement outillés pour cela, est la solution s&#8217;intitule <code>internationalisation</code>,
terme un peu long à écrire (18 caratères), c&#8217;est pour cela qu&#8217;il est
le plus souvent noté <code>i18n</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="identification-de-la-langue-de-l-utilisateur"><a class="anchor" href="#identification-de-la-langue-de-l-utilisateur"></a>Identification de la langue de l&#8217;utilisateur</h3>
<div class="paragraph">
<p>Rappelons-le, l&#8217;utilisateur sollicite un service d&#8217;une application web par le biais d&#8217;une requête HTTP.
Cette dernière embarque dans son entête certaines données (implicitement) telles que des informations
sur le navigateur du client et sa langue (<code>Accept-Language</code>) :</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/http-request-lang.png" alt="http-request-lang"></span></p>
</div>
<div class="paragraph">
<p>La valeur de <code>Accept-Language</code> du client HTTP peut être exploitée par les applications web
afin d&#8217;adapter le texte de la réponse à la langue
de l&#8217;utilisateur.</p>
</div>
</div>
<div class="sect2">
<h3 id="externalisation-des-messages"><a class="anchor" href="#externalisation-des-messages"></a>Externalisation des messages</h3>
<div class="paragraph">
<p>On entend par message tout texte destiné à être présenté à l&#8217;utilisateur.</p>
</div>
<div class="paragraph">
<p>Exemple de message non internationalisé :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">  <span class="tag">&lt;label</span> <span class="attribute-name">th:for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${product.name}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Nom du produit :<span class="tag">&lt;/label&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Le même exemple i18n :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">  <span class="tag">&lt;label</span> <span class="attribute-name">th:for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${product.name}</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{product.name}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Nom du produit<span class="tag">&lt;/label&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Le contenu textuel du label (<code>Nom du produit</code>) dans cet exemple i18n n&#8217;est là que pour
documenter le code source : il sera remplacé par la <strong>valeur</strong> associée à la <strong>clé</strong> <code>product.name</code> présente
dans un fichier de ressource sélectionné par Spring (à défaut, c&#8217;est la clé elle-même qui sera rendue).
Observez la syntaxe d&#8217;un message i18n avec thymeleaf : <code>#{clé}</code></p>
</div>
<div class="paragraph">
<p>Pour disposer d&#8217;une telle ressource, il suffit de créer un fichier <code>messages.properties</code>
et autant d&#8217;autres fichiers <code>.properties</code> qu&#8217;il y a de langues couvertes par l&#8217;application,
à partir du dossier <code>src/main/resources</code>. Exemple :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>|-- pom.xml
|-- src
|   |-- main
|   |   |-- java
|   |   |   `...
|   |   `-- resources
|   |       |-- application.properties
|   |       |-- i18n
|   |       |   |-- messages.properties
|   |       |   |-- messages_fr.properties
|   |       |   |-- messages_us.properties
|   |       |   |-- validationMessages.properties
|   |       |   |-- validationMessages_fr.properties
|   |       |   `-- validationMessages_us.properties
|   |       |-- static
|   |       |   |-- css
|   |       |   |   |-- cinema.css
|   |       |   |   `-- jumbotron.css
|   |       |   `-- favicon.ico
|   |       `-- templates
|   |           |...
|   |
|   `...</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
par défaut, <code>messages.properties</code> est attendu à la racine du dossier <code>resources</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Exemple de messages traduits :</p>
</div>
<div class="listingblock">
<div class="content">
<pre># messages.properties
site.title=My cinema
reservationConfirmation=We have processed your reservation - thank you</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre># messages_fr.properties
site.title=Mon cinema
reservationConfirmation=Nous avons précédé à votre réservation - merci</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-des-chemins-de-messages"><a class="anchor" href="#configuration-des-chemins-de-messages"></a>Configuration des chemins de messages</h3>
<div class="paragraph">
<p>Le dossier racine des messages, ainsi que leur préfixe, peuvent être paramétrés.
Dans le but de centraliser les instructions de configurations, nous créons une classe
dédiée qui expose des beans de configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fr.laerce.cinema.config</span>;

<span class="keyword">import</span> <span class="include">org.springframework.context.MessageSource</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.Bean</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.Configuration</span>;
<span class="keyword">import</span> <span class="include">java.util.Locale</span>;

<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">InternationalizationConfig</span> <span class="directive">extends</span> WebMvcConfigurerAdapter {

  <span class="comment">/**
   * This is where we'll add the interceptor object
   * that handles internationalization
   */</span>
  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> addInterceptors(InterceptorRegistry registry) {
    registry.addInterceptor(localeChangeInterceptor());
  }

  <span class="comment">/**
   * Set encoding and prefix file name of messages resources
   * @return
   */</span>
  <span class="annotation">@Bean</span>
  <span class="directive">public</span> MessageSource messageSource() {
    ReloadableResourceBundleMessageSource messageSource =
      <span class="keyword">new</span> ReloadableResourceBundleMessageSource();
    messageSource.setBasename(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/i18n/messages</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>
    messageSource.setDefaultEncoding(<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="keyword">return</span> messageSource;
  }

  <span class="directive">private</span> MessageSource messageSourceValidator() {
    ReloadableResourceBundleMessageSource messageSource =
      <span class="keyword">new</span> ReloadableResourceBundleMessageSource();
    messageSource.setBasename(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/i18n/validationMessages</span><span class="delimiter">&quot;</span></span>);
    messageSource.setDefaultEncoding(<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> messageSource;
  }

  <span class="annotation">@Bean</span>
  <span class="directive">public</span> LocalValidatorFactoryBean validator() {
    LocalValidatorFactoryBean bean = <span class="keyword">new</span> LocalValidatorFactoryBean();
    bean.setValidationMessageSource(messageSourceValidator());
    <span class="keyword">return</span> bean;
  }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Définit le sous-dossier et le préfixe des fichiers de messages (<code>messages</code> est le préfixe par défaut)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Encoder les messages en UTF-8 (attention à sélectionner également UTF-8 comme encodage par défaut des
fichiers dans votre éditeur)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Il peut être pratique, pour un utilisateur, de sélectionner une des langues supportées
par l&#8217;application. Dans ce cas on configure le resolver de message afin de lui permettre
de sélectionner un fichier de langue sur la base d&#8217;un paramètre (par convention c&#8217;est
la variable <code>lang</code> qui est définie).</p>
</div>
<div class="paragraph">
<p>On ajoutera à la classe <code>InternationalizationConfig</code> les beans de configuration suivants :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="comment">/**
   * Instantiate the appropriate locale resolution strategy
   *
   * @return locale resolver
   */</span>
  <span class="annotation">@Bean</span>
  <span class="directive">public</span> LocaleResolver localeResolver() {
    <span class="comment">// stores locale info in the session</span>
    SessionLocaleResolver resolver = <span class="keyword">new</span> SessionLocaleResolver();

    <span class="comment">//default to US locale</span>
    resolver.setDefaultLocale(<span class="predefined-type">Locale</span>.US);

    <span class="keyword">return</span> resolver;
  }


  <span class="comment">/**
   * This interceptor allows visitors to change the locale
   *
   * @return a LocaleChangeInterceptor object
   */</span>
  <span class="annotation">@Bean</span>
  <span class="directive">public</span> LocaleChangeInterceptor localeChangeInterceptor() {
    LocaleChangeInterceptor interceptor = <span class="keyword">new</span> LocaleChangeInterceptor();

    <span class="comment">//the request param that we'll use to determine the locale</span>
    interceptor.setParamName(<span class="string"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>);

    <span class="keyword">return</span> interceptor;
  }


  <span class="comment">/**
   * This is where we'll add the interceptor object
   * that handles internationalization
   */</span>
  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> addInterceptors(InterceptorRegistry registry) {
    registry.addInterceptor(localeChangeInterceptor());
  }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="détection-et-changement-de-langue"><a class="anchor" href="#détection-et-changement-de-langue"></a>Détection et changement de langue</h3>
<div class="paragraph">
<p>Nous avons vu que le choix de la langue (du fichier des messages) dépend de la configuration
de l&#8217;application, dans les cas les plus courants ce choix est basé sur :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>valeur de <code>Accept-Language</code> de l&#8217;entête HTTP (traitement
par défaut, basé sur la configuration du client)</p>
</li>
<li>
<p>valeur de la variable <code>lang</code> (une valeur par défaut est définie côté serveur)</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Le fichier <code>messages.properties</code> est celui qui sera utilisé en cas d&#8217;absence de fichier de traduction de la langue demandée.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="format-des-messages"><a class="anchor" href="#format-des-messages"></a>Format des messages</h3>
<div class="paragraph">
<p>Le format des messages est celui attendu
par l' <a href="https://docs.oracle.com/javase/10/docs/api/java/text/MessageFormat.html">API MessageFormat</a>.
Ce sont des chaînes de caractères pouvant être paramétrées :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// src/main/resources/i18n/messages.properties</span>

info.category.products =The category <span class="error">\</span><span class="string"><span class="delimiter">&quot;</span><span class="content">{1}</span><span class="char">\&quot;</span><span class="content"> contains {0} product(s)</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exemple d&#8217;un cas d&#8217;utilisation :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">// src/main/resources/templates/index/index.html

  <span class="tag">&lt;h1</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{info.category.products(1234, 'sport')}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/h1&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Qui produira la sortie suivante :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">  <span class="tag">&lt;h1&gt;</span>The category &quot;sport&quot; contains 1234 product(s)<span class="tag">&lt;/h1&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Plus vraisemblablement, le code aura une portée plus générale, comme ici :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">  <span class="tag">&lt;h1</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{info.category.products(${#lists.size(cat)}, ${cat.name})}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/h1&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>#lists.size</code> est une des méthodes bien pratique des objets <em>helper</em> de thymeleaf. Ces objets gèrent les types de base (<code>String</code>, <code>List</code>, <code>Set</code>, etc.).
Par exemple : <code>${#objects.nullSafe(obj,default)}</code>, mais aussi <code>URL</code>, <code>Message</code>&#8230;&#8203;.
  <a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#appendix-b-expression-utility-objects">voir la liste des helpers</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="messages-en-dehors-de-thymeleaf"><a class="anchor" href="#messages-en-dehors-de-thymeleaf"></a>Messages en dehors de thymeleaf</h3>
<div class="paragraph">
<p>Bien entendu, le développeur fera usage des messages i18n
sur l&#8217;ensemble de son projet, et pas seulement directement sur les vues.</p>
</div>
<div class="paragraph">
<p>En effet, le système de validation fait un usage intensif de messages i18n.</p>
</div>
<div class="sect3">
<h4 id="dans-la-définition-d-une-annotation"><a class="anchor" href="#dans-la-définition-d-une-annotation"></a>Dans la définition d&#8217;une annotation</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Target</span>({ <span class="predefined-type">ElementType</span>.TYPE})
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Constraint</span>(validatedBy = PersonConstraintValidator.class)
<span class="annotation">@Documented</span>
<span class="directive">public</span> <span class="annotation">@interface</span> PersonValidated {
  <span class="predefined-type">String</span> message() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">{person.bean.invalid}</span><span class="delimiter">&quot;</span></span>;
  ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dans-une-classe-de-validation"><a class="anchor" href="#dans-une-classe-de-validation"></a>Dans une classe de validation</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> validate(<span class="predefined-type">Object</span> obj, Errors e) {

  Person p = (Person) obj;
  <span class="comment">// senior must have 2 adresses or more.</span>
  <span class="keyword">if</span> (p.getAge() &gt; <span class="integer">80</span> &amp;&amp; p.getAddresses().size() &lt; <span class="integer">2</span>) {
    e.rejectValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">addresses</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">more.one.addresse.senior.citizen</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">constraint senior addresses</span><span class="delimiter">&quot;</span></span>);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dans-un-objet-métier"><a class="anchor" href="#dans-un-objet-métier"></a>Dans un objet métier</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span>{
...
  <span class="annotation">@Email</span>(message = <span class="string"><span class="delimiter">&quot;</span><span class="content">{email_invalid_error_message}</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@NotNull</span>(message = <span class="string"><span class="delimiter">&quot;</span><span class="content">{email_blank_error_essage}</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@Column</span>(unique = <span class="predefined-constant">true</span>, nullable = <span class="predefined-constant">false</span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> primaryEmail;
...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="conlusion"><a class="anchor" href="#conlusion"></a>Conlusion</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validation"><a class="anchor" href="#validation"></a>Validation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="présentation-5"><a class="anchor" href="#présentation-5"></a>Présentation</h3>
<div class="paragraph">
<p>Le contrôle de validité des <strong>données d&#8217;entrée</strong> est une tache incontrournable en développement web. On ne saurait être trop prudent car on ne peut supposer les intentions à l&#8217;origine d&#8217;une requête HTTP.</p>
</div>
<div class="paragraph">
<p>Les données d&#8217;entrée concernées ici sont celles :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dans l&#8217;url (exemple <code>product/23</code> ou  <code>product?id=23</code>)</p>
</li>
<li>
<p>dans le corps de la requête HTTP (comme c&#8217;est le cas avec <code>post</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La validité de ces données peut être vérifiée à grand coup de if..else dans le corps
des méthodes contrôleur. Cette façon risque fort d&#8217;introduire de la redondance de vérification et alourdira assurément le code.</p>
</div>
<div class="paragraph">
<p>Comme toujours, la réponse consiste à déléguer le travail de validation à des services dédiés, en particulier via l&#8217;API Java Bean Validation.</p>
</div>
</div>
<div class="sect2">
<h3 id="annotations-de-validation"><a class="anchor" href="#annotations-de-validation"></a>Annotations de validation</h3>
<div class="paragraph">
<p>Bean Validation définit un métamodèle et une API pour la validation de JavaBean.
Les métadonnées sont représentées par des <strong>annotations</strong> (<a href="https://jcp.org/en/jsr/detail?id=303">JSR-303 est la référence intiale</a>)</p>
</div>
<div class="paragraph">
<p>Bean Validation 2.0 est définie par JSR 380 (juillet 2017) et prend en compte les nouvelles caractéristiques de Java 8 (version minimum requise de Java)</p>
</div>
<div class="paragraph">
<p>Hibernate propose une implémente de référence (<a href="http://hibernate.org/validator/">hibernate.org/validator</a>).</p>
</div>
<div class="paragraph">
<p>L&#8217;usage des annotations permet facilement de lier, à un même élément, une à plusieurs contraintes, appelées aussi régles de validation (<em>validation rules</em>).</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Table Annotations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contrainte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@Null</strong> <strong>@NotNull</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;élément annoté doit être <strong>null</strong> ou <strong>différent de null</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@AssertTrue  @AssertFalse</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;élément annoté doit être <strong>true</strong> ou <strong>false</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@Min(value)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;élément annoté doit être un nombre dont la valeur est supérieure ou égale au minimum spécifié.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@Max(value)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;élément annoté doit être un nombre dont la valeur est inférieure ou égale au maximum spécifié. Voir aussi <strong>@DecimalMin</strong>, <strong>@DecimalMax</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@Size(min=, max=)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;élément annoté doit être un nombre dont la valeur est dans les bornes spécifiées (inclusives)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@Negative</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;élément annoté doit être un nombre <strong>strictement négatif</strong> (zéro est considéré comme une valeur invalide). Voir aussi <strong>@NegativeOrZero</strong>, <strong>@Positive</strong>, <strong>@PositiveOrZero</strong>, <strong>@Digits</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@Future</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;élément annoté doit être un instant, date ou time, dans le futur. Voir aussi <strong>@Past</strong>, <strong>@PastOrPresent</strong>, <strong>@FutureOrPresent</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@Pattern(regexp =)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;élément annoté doit être validé par l&#8217;expression régulière</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@NotEmpty</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;élément annoté doit être non vide. Type supporté : <code>CharSequence</code>, <code>Collection</code>, <code>Map</code>, <code>array</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@NotBlank</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;élément annoté doit être non null et doit contenir au moins un caractère 'non-blanc'. Type supporté : <code>CharSequence</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@Email</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;élément annoté (String) doit être une adresse email bine-formée.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@CreditCardNumber</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(hibernate) L&#8217;élément annoté représente un numéro de carte de credit. Vérifie selon l&#8217;implémentation de l&#8217;algorithme Luhn (qui traite de la syntaxe, non de la validité !)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Voir une liste ici : <a href="https://beanvalidation.org/2.0/spec/#builtinconstraints/">table-builtin-constraints</a></p>
</div>
</div>
<div class="sect2">
<h3 id="validation-des-données-de-requêtes"><a class="anchor" href="#validation-des-données-de-requêtes"></a>Validation des données de requêtes</h3>
<div class="paragraph">
<p>Les données sont celles passées dans l&#8217;url, comme par exemple la valeur <code>23</code> dans : <em>product?id=23</em>  ou <em>product/23</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Validated</span>
<span class="annotation">@Controller</span>
<span class="annotation">@RequestMapping</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/person</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">PersonController</span> {

  <span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/validateMinNameParam</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">public</span> <span class="predefined-type">String</span> validateMinNameParam(
    <span class="annotation">@RequestParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@Size</span>(min=<span class="integer">2</span>) <span class="predefined-type">String</span> name) {
    <span class="comment">// ...</span>
  }

  <span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/validateMinName/{name}</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">public</span> <span class="predefined-type">String</span> validateMinNamePathVariable(
    <span class="annotation">@PathVariable</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@Size</span>(min=<span class="integer">2</span>) <span class="predefined-type">String</span> name) {
    <span class="comment">// ...</span>
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>On prendra soin de déclarer l&#8217;annotation @Validated au niveau de la classe contrôleur.</p>
</div>
<div class="paragraph">
<p>Par défaut, une exception <code>ConstraintViolationException</code> sera déclenchée en cas de non respect de la contrainte sur le paramètre ou variable <code>name</code>.</p>
</div>
<div class="paragraph">
<p>Remarque : Par la suite <code>@Validated</code> devra être retiré pour supprimer l&#8217;effet <code>ConstraintViolationException</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="validation-de-niveau-attributs-de-bean"><a class="anchor" href="#validation-de-niveau-attributs-de-bean"></a>Validation de niveau attributs de bean</h3>
<div class="paragraph">
<p>Lorsque les données sont transmises par <code>post</code>, ces données
peuvent être affectées aux différents attributs d&#8217;un <strong>bean</strong> :
la logique d&#8217;affectation est basée sur correspondance entre le nom
de l&#8217;attribut (d&#8217;un setter) et la clé (la propriété <em>name</em>) de la valeur d&#8217;entrée.</p>
</div>
<div class="paragraph">
<p>Pour réaliser cette tâche, Spring utilise les techniques de <em>data binding</em> (JavaBeans Specifications) et
des convertisseurs.</p>
</div>
<div class="paragraph">
<p>Dans cet exemple, les données d&#8217;entrée (<code>post</code>) sont mappées dans un objet <code>FormPerson</code> pour être ensuite passé en argument du contrôleur (méthode).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre>
<span class="annotation">@PostMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/add</span><span class="delimiter">&quot;</span></span>)
 <span class="directive">public</span> <span class="predefined-type">String</span> submit(<span class="annotation">@ModelAttribute</span> FormPerson person){
   <span class="comment">// ...</span>
   <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">redirect:/person/list</span><span class="delimiter">&quot;</span></span>;
 }
</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Nous pouvons alors demander la validation du bean en question. Par prudence nous utilisons ici un <em>Form Bean</em>  (l&#8217;approche par des beans métier est contestée<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup>).
Pour ce faire, nous pouvons associer, au niveau d&#8217;un attribut (<em>field</em>),
des contraintes déclaratives (<code>JSR-380</code> d&#8217;aout 2017). Exemple :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td>
  <td class="code"><pre><span class="directive">public</span> <span class="type">class</span> <span class="class">FormPerson</span> {

  <span class="annotation">@NotBlank</span>
  <span class="annotation">@Size</span>(min=<span class="integer">2</span>, max=<span class="integer">30</span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> name;

  <span class="annotation">@NotNull</span>
  <span class="annotation">@Min</span>(value=<span class="integer">18</span>, message=<span class="string"><span class="delimiter">&quot;</span><span class="content">{person.age.minor}</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="directive">private</span> <span class="predefined-type">Integer</span> age;

  <span class="annotation">@Size</span>(min=<span class="integer">1</span>, max=<span class="integer">3</span>)
  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="annotation">@NotBlank</span>(message=<span class="string"><span class="delimiter">&quot;</span><span class="content">{person.address.notblank}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span>&gt; addresses; <i class="conum" data-value="2"></i><b>(2)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La valeur du message peut être une clé i18n (comme ici) ou une constante littérale</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contrainte sur les éléments de la collection <em>addresses</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La validation des contraintes doit être demandée.
Pour ce faire, deux déclarations sont attendues :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>placement de l&#8217;annotation <strong>@Valid</strong> sur le bean injecté en argument de la méthode contrôleur</p>
</li>
<li>
<p>déclaration d&#8217;un paramètre (injecté) de type <strong>BindingResult</strong> qui portera les informations résultantes de la validation.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre>
<span class="annotation">@PostMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/add</span><span class="delimiter">&quot;</span></span>)
 <span class="directive">public</span> <span class="predefined-type">String</span> submit(<span class="annotation">@Valid</span> <span class="annotation">@ModelAttribute</span> Person person, BindingResult result){
   <span class="keyword">if</span> (result.hasErrors()) {
        <span class="keyword">return</span> ... ;
    }
   <span class="comment">// ...</span>
   <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">redirect:/person/list</span><span class="delimiter">&quot;</span></span>;
 }
</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>À noter que l&#8217;action de validation peut être réalisée manuellement dans le corps
de la méthode contrôleur (il faut dans ce cas ne pas utiliser @Valid ni BindingResult).
Un exemple ici : <a href="https://www.baeldung.com/javax-validation" class="bare">https://www.baeldung.com/javax-validation</a></p>
</div>
</div>
<div class="sect2">
<h3 id="validation-de-niveau-bean"><a class="anchor" href="#validation-de-niveau-bean"></a>Validation de niveau bean</h3>
<div class="paragraph">
<p>Les contraintes présentées jusqu&#8217;ici agissent au niveau de l&#8217;attribut.
Pour des contraintes plus globales (cas de contraintes interdépendantes sur des attributs) on définira une <strong>contrainte métier</strong> au niveau de l&#8217;objet (de sa classe).</p>
</div>
<div class="paragraph">
<p>Par leur nature très spécifique, ces contraintes doivent être programmées, leur classe doivent
implémenter l&#8217;interface <code>org.springframework.validation.Validator</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
  <td class="code"><pre><span class="directive">public</span> <span class="type">class</span> <span class="class">FormPersonValidator</span> <span class="directive">implements</span> <span class="predefined-type">Validator</span> {

  <span class="comment">/**
   * This Validator validates just Person instances
   */</span>
  <span class="directive">public</span> <span class="type">boolean</span> supports(<span class="predefined-type">Class</span> clazz) {
    <span class="keyword">return</span> FormPerson.class.equals(clazz); <i class="conum" data-value="1"></i><b>(1)</b>
  }

  <span class="directive">public</span> <span class="type">void</span> validate(<span class="predefined-type">Object</span> obj, Errors e) {<i class="conum" data-value="2"></i><b>(2)</b>
    ValidationUtils.rejectIfEmpty(e, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name.empty</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>

    FormPerson p = (FormPerson) obj;
    <span class="comment">// senior must have 2 adresses or more.</span>
    <span class="keyword">if</span> (p.getAge() &gt; <span class="integer">80</span> &amp;&amp; p.getAddresses().size() &lt; <span class="integer">2</span>) {
      e.rejectValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">addresses</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">more.one.addresse.senior.citizen</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">constraint senior addresses</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="4"></i><b>(4)</b>
    }
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Détermine la portée du validateur</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Le premier argument est l&#8217;objet à valider, le deuxième représente le <strong>BindingResult</strong> (implémente <code>Errors</code>) qui sera passé au contrôleur</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Une valeur 'empty' dans ce contexte signifie soit null soit chaine vide "". L&#8217;objet disposant de cet attribut ('name') n&#8217;a pas besoin d&#8217;être passé à cette méthode car l&#8217;objet <code>Errors</code> détient déjà une référence interne à l&#8217;objet cible.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>La méthode <code>rejectValue</code> nous permet de déclarer une erreur liée à un attribut (<a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/Errors.html#rejectValue-java.lang.String-java.lang.String-">rejectValue API</a>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/rejectValue-api.png" alt="rejectValue-api"></span></p>
</div>
<div class="sect3">
<h4 id="activation-dans-un-contrôleur"><a class="anchor" href="#activation-dans-un-contrôleur"></a>Activation dans un contrôleur</h4>
<div class="paragraph">
<p>Il existe plusieurs façons de faire, mais toutes sont dans un esprit de délégation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>par injection du validateur</p>
</li>
<li>
<p>via une annotation</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="par-injection-explicite"><a class="anchor" href="#par-injection-explicite"></a>Par injection explicite</h5>
<div class="paragraph">
<p>On déclare le validateur en tant que composant via l&#8217;annotation <code>@Component</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.validation.Validator</span>;

<span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FormPersonValidator</span> <span class="directive">implements</span> <span class="predefined-type">Validator</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Puis un injecteur (sur l&#8217;attribut) dans la classe contrôleur :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre>
<span class="annotation">@Controller</span>
<span class="annotation">@RequestMapping</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/person</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">PersonController</span> {

    <span class="annotation">@Autowired</span>
    FormPersonValidator personValidator;
    ...</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Que l&#8217;on utilise dans une méthode de ce contrôleur :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre>
<span class="annotation">@PostMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/add</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">String</span> submit(<span class="annotation">@ModelAttribute</span> FormPerson personDto, BindingResult result){ <i class="conum" data-value="1"></i><b>(1)</b>

  personValidator.validate(personDto, result); <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="keyword">if</span> (result.hasErrors()) { <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">person/form</span><span class="delimiter">&quot;</span></span>;
  }

  Person person = converToEntity(personDto); <i class="conum" data-value="4"></i><b>(4)</b>

  personneDao.save(person);
  <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">redirect:/person/list</span><span class="delimiter">&quot;</span></span>;
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Le paramètre <code>BindingResult</code> sert à stocker les différentes erreurs détectées par les validateurs.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Lance la logique de validation.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>En façon simple de détecter la présence d&#8217;erreurs. Dans ce cas, on retourne à la vue du formulaire
qui se chargera de présenter les erreurs à 'utilisateur (chapitre suivant)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Conversion d&#8217;un DTO vers un objet métier. à ce sujet voir <a href="https://www.baeldung.com/entity-to-and-from-dto-for-a-java-spring-application">entity-to-and-from-dto-for-a-java-spring-application</a></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="par-annotation"><a class="anchor" href="#par-annotation"></a>Par annotation</h5>
<div class="paragraph">
<p>Cette autre façon, assez élégante, consiste à définir une <strong>annotation personnalisée</strong>
 et s&#8217;appuie non plus sur l&#8217;API de validation de spring mais sur l&#8217;API javax.validation, de concert avec la logique de l&#8217;annotation <code>@Valid</code>.</p>
</div>
<div class="paragraph">
<p>Pour commencer on définiera 2 composants :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Le validateur (<code>PersonConstraintValidator</code>)</p>
</li>
<li>
<p>L&#8217;annotation associée (<code>PersonValidated</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Le validateur :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
  <td class="code"><pre><span class="keyword">import</span> <span class="include">javax.validation.ConstraintValidator</span>;
<span class="keyword">import</span> <span class="include">javax.validation.ConstraintValidatorContext</span>;


<span class="directive">public</span> <span class="type">class</span> <span class="class">PersonConstraintValidator</span>
       <span class="directive">implements</span> ConstraintValidator&lt;PersonValidated, FormPerson&gt; { <i class="conum" data-value="1"></i><b>(1)</b>

   <span class="directive">public</span> <span class="type">void</span> initialize(PersonValidated constraint) { } <i class="conum" data-value="2"></i><b>(2)</b>

   <span class="directive">public</span> <span class="type">boolean</span> isValid(FormPerson p, ConstraintValidatorContext context) { <i class="conum" data-value="3"></i><b>(3)</b>

     <span class="comment">// senior must have 2 adresses or more.</span>
     <span class="keyword">if</span> (p.getAge() &gt; <span class="integer">80</span> &amp;&amp; p.getAddresses().size() &lt; <span class="integer">2</span>) {
       <span class="keyword">return</span> <span class="predefined-constant">false</span>;
     }

     <span class="keyword">return</span> <span class="predefined-constant">true</span>;
   }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>L&#8217;interface est paramétrée par l&#8217;interface décrivant l&#8217;annotation personnalisée (que nous définissons juste après) et par le type de l&#8217;objet à valider.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Pour recevoir les valeurs éventuelles d&#8217;attributs associés à l&#8217;annotation (aucun ici)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Cette méthode est le centre d&#8217;appel des règles métier.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nous allons maintenant créer l&#8217;annotation que nous appellerons <code>PersonValidated</code> - (voir <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/package-summary.html">Annotation API</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
  <td class="code"><pre><span class="keyword">package</span> <span class="namespace">fr.laerce.cinema.annotation</span>;

<span class="keyword">import</span> <span class="include">fr.laerce.cinema.validator.PersonValidator</span>;

<span class="keyword">import</span> <span class="include">javax.validation.Constraint</span>;
<span class="keyword">import</span> <span class="include">javax.validation.Payload</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation</span>.*;

<span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.TYPE})  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@Constraint</span>(validatedBy = PersonConstraintValidator.class) <i class="conum" data-value="3"></i><b>(3)</b>
<span class="annotation">@Documented</span> <i class="conum" data-value="4"></i><b>(4)</b>
<span class="directive">public</span> <span class="annotation">@interface</span> PersonValidated { <i class="conum" data-value="5"></i><b>(5)</b>
  <span class="predefined-type">String</span> message() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">{person.senioraddresses.invalid}</span><span class="delimiter">&quot;</span></span>; <i class="conum" data-value="6"></i><b>(6)</b>
  <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> groups() <span class="keyword">default</span> {};
  <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> Payload&gt;<span class="type">[]</span> payload() <span class="keyword">default</span> {};
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La cible de la validation, ici c&#8217;est la classe qui est ciblée, sinon ce peut être un attribut (<code>FIELD</code>), un
constructeur (<code>CONSTRUCTOR</code>) &#8230;&#8203; (classes, méthodes, attributs, paramètres, variables locales et packages : <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/ElementType.html">ElementType</a>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>La durée de vie (ici la plus longue)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Renseigne la classe d&#8217;implémentation de la validation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>L&#8217;annotation fera partie de la documentation JavaDoc</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Le nom de l&#8217;interface, qui sera le <strong>nom de l&#8217;annotation</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Le message (ou la clé du message) utilisé en cas d&#8217;invalidation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nous pouvons maintenent utiliser l&#8217;annotation sur la classe métier :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre><span class="annotation">@PersonValidated</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FormPerson</span> {
  ...
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Placement de notre annotation <code>PersonValidated</code> (de portée glogale à la classe <code>FormPerson</code>), qui s&#8217;ajoute aux autres.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>L&#8217;activation des opérations de validation se déclare, là où on en a besoin, par la présence de l&#8217;annotation <code>@Valid</code>, par exemple ici dans une méthode contrôleur.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>
<span class="annotation">@PostMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/add</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">String</span> submit(<span class="annotation">@Valid</span> <span class="annotation">@ModelAttribute</span> FormPerson personDto, BindingResult result){ <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="keyword">if</span> (result.hasErrors()) { <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">person/form</span><span class="delimiter">&quot;</span></span>;
  }

  Person person = converToEntity(personDto);

  personneDao.save(person);
  <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">redirect:/person/list</span><span class="delimiter">&quot;</span></span>;
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>On remarquera l&#8217;annotation <code>@Valid</code> placée avant et sur le paramètre <code>FormPerson</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Suivi de <code>BindingResult</code> qui détiendra le résultat des opérations de validations (l&#8217;absence de ce paramètre entrainera une erreur)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Même logique que précédemment</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="montrer-les-erreurs-logique-de-présentation"><a class="anchor" href="#montrer-les-erreurs-logique-de-présentation"></a>Montrer les erreurs (logique de présentation)</h3>
<div class="paragraph">
<p>Nous nous placons dans le cas d&#8217;une logique de présentation déportée à <em>thymeleaf</em>.</p>
</div>
<div class="sect3">
<h4 id="logiques-de-présentation-des-erreurs"><a class="anchor" href="#logiques-de-présentation-des-erreurs"></a>Logiques de présentation des erreurs</h4>
<div class="paragraph">
<p>On se place dans le cas où un utilisateur soumet un formulaire. Côté serveur, la validation peut révéler des erreurs
 d&#8217;entrée, suite par exemple à un non respect des consignes communiquées à l&#8217;utilisateur.</p>
</div>
<div class="paragraph">
<p>Le scénario classique consiste alors à retourner le formulaire à l&#8217;utilisateur en
lui soulignant les points posant problème.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Agir sur la classe CSS</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>L&#8217;idée consiste, en cas d&#8217;erreurs, à ajouter une classe CSS aux classes de l&#8217;élément :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*{age}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">small</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:errorclass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fieldError</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si l&#8217;age (attribut de l&#8217;objet liée au formulaire) n&#8217;est pas validé (par exemple on attend un age &gt;= 18 alors que l&#8217;utilisateur a rentré 12), alors la sortie
 sera de cette forme :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">12</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">small fieldError</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Agir l&#8217;ajout d&#8217;un message d&#8217;erreur</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>L&#8217;idée consiste à ajouter un élément HTML près de celui qui pose problème.
Dans cet exemple on ajoute, sous condition d&#8217;erreurs, un élément paragraphe <code>p</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*{age}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;p</span> <span class="attribute-name">th:if</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${#fields.hasErrors('age')}</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fielderr</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:errors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*{age}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Incorrect date<span class="tag">&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On remarquera l&#8217;usage de :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>th:if</code> qui conditionne l&#8217;insertion du paragraphe</p>
</li>
<li>
<p><code>th:errors</code> (au pluriel) afin d&#8217;obtenir <strong>tous</strong> les messages d&#8217;erreurs liés à l&#8217;attribut <code>age</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On se refera à <a href="https://www.thymeleaf.org/doc/tutorials/2.1/thymeleafspring.html#validation-and-error-messages">th : validation-and-error-messages</a></p>
</div>
<div class="paragraph">
<p>à titre d&#8217;exemple :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td>
  <td class="code"><pre><span class="keyword">package</span> <span class="namespace">fr.laerce.cinema.annotation</span>;

<span class="keyword">import</span> <span class="include">fr.laerce.cinema.validator.PersonValidator</span>;

<span class="keyword">import</span> <span class="include">javax.validation.Constraint</span>;
<span class="keyword">import</span> <span class="include">javax.validation.Payload</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation</span>.*;

<span class="annotation">@Target</span>({ <span class="predefined-type">ElementType</span>.TYPE})
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Constraint</span>(validatedBy = PersonConstraintValidator.class)
<span class="annotation">@Documented</span>
<span class="directive">public</span> <span class="annotation">@interface</span> PersonValidated {
  <span class="predefined-type">String</span> message() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">{person.bean.invalid}</span><span class="delimiter">&quot;</span></span>;
  <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> groups() <span class="keyword">default</span> {};
  <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> Payload&gt;<span class="type">[]</span> payload() <span class="keyword">default</span> {};
}

...

public <span class="type">class</span> <span class="class">PersonConstraintValidator</span>
  <span class="directive">implements</span> ConstraintValidator&lt;PersonValidated, FormPerson&gt; {

  <span class="directive">public</span> <span class="type">void</span> initialize(PersonValidated constraint) {

  }

  <span class="directive">public</span> <span class="type">boolean</span> isValid(FormPerson p, ConstraintValidatorContext context) {

    <span class="keyword">if</span> (p.getSurname() == <span class="predefined-constant">null</span> || p.getSurname().isEmpty())
       <span class="keyword">return</span> <span class="predefined-constant">false</span>;

     <span class="keyword">if</span> (p.getBirthYear() == <span class="predefined-constant">null</span> || p.getBirthYear() &lt; <span class="integer">0</span>) {
       <span class="keyword">return</span> <span class="predefined-constant">false</span>;
     }

     <span class="keyword">return</span> <span class="predefined-constant">true</span>;
   }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE HTML&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns:th</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.thymeleaf.org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;head&gt;</span>
  <span class="tag">&lt;th:block</span> <span class="attribute-name">th:replace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fragments/header :: header-css</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">th:replace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fragments/header :: menu(activeTab='actors')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;main</span> <span class="attribute-name">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jumbotron</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;h5</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">display-5</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${person.id} ?</span>
          <span class="content">#{form.person.update} :</span>
          <span class="content">#{form.person.add}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Person<span class="tag">&lt;/h5&gt;</span>

      <span class="tag">&lt;div</span> <span class="attribute-name">th:if</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${#fields.hasErrors('${person.*}')}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;ul&gt;</span>
          <span class="tag">&lt;li</span> <span class="attribute-name">th:each</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">e : ${#fields.detailedErrors('${person.*}')}</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">th:class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${e.global}? globalerr : fielderr</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;span</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${e.global}? '*' : ${e.fieldName}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> * or field<span class="tag">&lt;/span&gt;</span> |
            <span class="tag">&lt;span</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${e.message}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>The error message<span class="tag">&lt;/span&gt;</span>
          <span class="tag">&lt;/li&gt;</span>
        <span class="tag">&lt;/ul&gt;</span>
      <span class="tag">&lt;/div&gt;</span>

      <span class="tag">&lt;form</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@{/person/add}</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">th:object</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${person}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">enctype</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">multipart/form-data</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

        <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*{id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*{imagePath}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form-group</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;label</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{form.givenname}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>First name<span class="tag">&lt;/label&gt;</span>
          <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form-control</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">aria-describedby</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">givennameHelp</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">th:attr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">placeholder=#{form.givenname}</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">th:field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*{givenname}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;p</span> <span class="attribute-name">th:if</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${#fields.hasErrors('givenname')}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">th:errors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*{givenname}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fielderr</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Incorrect
            givename<span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;/div&gt;</span>

        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form-group</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

          <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form-control</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">aria-describedby</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">surnameHelp</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">th:attr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">placeholder=#{form.surname}</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">th:field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*{surname}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;p</span> <span class="attribute-name">th:if</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${#fields.hasErrors('surname')}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">th:errors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*{surname}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fielderr</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Incorrect
            surname<span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;/div&gt;</span>
        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form-group</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;label</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{form.birthyear}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Annee de naissance<span class="tag">&lt;/label&gt;</span>
          <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form-control</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">aria-describedby</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">birthYearHelp</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">th:attr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">placeholder=#{form.birthyear}</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">th:field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*{birthYear}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;p</span> <span class="attribute-name">th:if</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${#fields.hasErrors('birthYear')}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">th:errors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*{birthYear}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fielderr</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Incorrect date<span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;/div&gt;</span>

        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form-group</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;label</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{form.person.picture}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>file input<span class="tag">&lt;/label&gt;</span>
          <span class="tag">&lt;p&gt;</span><span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form-control-file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">photo</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;span</span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*{imagePath}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Fichier photo<span class="tag">&lt;/span&gt;</span>
          <span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;/div&gt;</span>

        <span class="tag">&lt;div</span> <span class="attribute-name">th:if</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${person.id}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">card</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">width</span>: <span class="float">15</span><span class="value">rem</span>;  <span class="key">margin-top</span>: <span class="float">2px</span>; <span class="key">margin-bottom</span>: <span class="float">2px</span>;<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;img</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">image-rounded img-fluid</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width:100%</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">th:src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@{'/person/imagename/'+${person.imagePath}}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">card-body</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;p</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">card-text</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${person.givenname + ' ' +person.surname}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/p&gt;</span>
          <span class="tag">&lt;/div&gt;</span>
        <span class="tag">&lt;/div&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">th:text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{form.submit}</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">btn btn-primary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Submit<span class="tag">&lt;/button&gt;</span>
      <span class="tag">&lt;/form&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
  <span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/main&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">th:replace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fragments/footer.html :: footer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Et une interprétation du code résultant par le navigateur :</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/cinema-error-ui.png" alt="cinema-error-ui"></span></p>
</div>
<div class="paragraph">
<p>Remarque : le validateur est utilisé pour déterminer la validité de l&#8217;année de naissance à titre d&#8217;exemple (pourrait être délégué à une annotation dans le cas d&#8217;une logique simple de contrôle)</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. <a href="https://twitter.com/odrotbohm/status/1055015506326052865">C&#8217;est peut être un peu tard&#8230;&#8203; Certains considèrent cette pratique comme un défaut de conception, à moins de passer par des DTO&#8230;&#8203;</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.2<br>
Last updated 2022-01-14 11:02:44 CET
</div>
</div>
</body>
</html>